#!/usr/bin/awk -f

function P(u,s,h){Y=y;X=x;C=i;do C+=c=substr(G[Y+=s],X+=u,X>0);while(++h*2<o)
h<o+4&&C-Q[k=Y"  "X" "u" "s" "h]~"-|"C&&c&&Q[C]=k" "Q[Q[k]=C]}W=NR"  "length{
G[NR]=$0}END{while(8>o)if(j=($0=i++?Q[i]:"1 1 0 1 0 1 1 1")~W){print--i;i=o--
o+=8;delete Q}else for(;y=$++j;P(v=$++j,h=+$++j,$++j)P(h,P(-h-p,v)-v))x=$++j}
