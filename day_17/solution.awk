#!/usr/bin/awk -f

function P(u,s,h){Y=y;X=x;C=i;do C+=c=substr(G[Y+=u],X+=s,0>-X)
while(++h*2<o);h<o+4&&(--C<B[k=Y"  "X-1" "u-1" "s" "h,o])+!B[k,
o]&&c&&Q[C]=k" "Q[B[k,o]=C]}W=NR"  "length-1{G[NR]=$0}END{for(;
Q[j=0]=8>o;)if(($0=Q[i++])~W){print--i;delete Q;i=o--;o+=8}else
while(y=$++j){x=$++j+1;P(v=$++j+1,h=$++j,$++j)P(h,-v,P(-h,v))}}
