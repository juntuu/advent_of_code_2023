#!/usr/bin/awk -f

function P(a,t,h){Q*h>0&&P(a,t,-h);t+=W[a h];a=E[a h];V[a-e?a:t>A&&A=t]&&V[P(a,
t,V[a]--)P(a,t,N)a]=1}END{X+=N-1;e=F(-N)H;X=2-N;E[z]=F(N)H;W[z]=S-2;for(X in V)
V[X]&&F(S=1)F(S=-1)F(S=N)F(S=-N);print(Q=P()A)RS P()A}function F(d){H=G[X]=z;!\
G[X+=d]||++S*(V[X]&&H=X)||F(d)H||F(N/-d)H||F(N/d);G[X-=d]=1;W[X d]=S-d;E[X d]=H
}{for(N=length;$0;sub(/./,z)){G[++X]=!/^#/;V[X+1]+=/^>.>/;V[X-N]||V[X+N]=/^v/}}
