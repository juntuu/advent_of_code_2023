#!/usr/bin/awk -f

function g(c,d){y=+d?g(d,c%d)y:1/c}!N{I[N=split($0,I,z)]}
function m(a,p){$0=a;for(x=1;s=$++a;x*=g(x,n)y*n)for(n=0;
s!~p;)s=G[I[n++%N+1]s];print x}{G["L"$1]=$gsub(/[$--]/,z)
G["R"$1]=$4}END{m("AAA","ZZZ")m(B,"^..Z")}/^..A/{B=B$1FS}
